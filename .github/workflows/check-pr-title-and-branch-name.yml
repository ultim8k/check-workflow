name: Validate Branch name and PR title

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Debug
        run: |
          echo "DEBUG:"
          echo "GITHUB_REF_NAME: ${{ github.ref_name }}"
          echo "GITHUB_REF_TYPE: ${{github.ref_type}}"
          echo "PR_TITLE: ${{ github.event.pull_request.title }}"

      - name: Check branch name against regex pattern
        if: github.ref_type == 'branch'
        run: |
          BRANCH_NAME="${{ github.ref_name }}"
          PATTERN="^(?:fix|feat|docs|style|refactor|perf|test|build|ci|chore|revert)/TICKET-\d{1,5}-.*"

          if [[ ! $BRANCH_NAME =~ $PATTERN ]]; then
            echo "Error: The branch name $BRANCH_NAME does not adhere to the required format."
            exit 1
          else
            echo "Branch name $BRANCH_NAME is valid."
          fi

      - name: Check PR title against regex pattern
        if: github.ref_type == 'branch'
        run: |
          PR_TITLE="${{ github.event.pull_request.title }}"
          PATTERN="^(?:fix|feat|docs|style|refactor|perf|test|build|ci|chore|revert)\(TICKET-\d{1,5}\): .*"

          if [[ ! $PR_TITLE =~ $PATTERN ]]; then
            echo "Error: The PR title '$PR_TITLE' does not adhere to the required format."
            exit 1
          else
            echo "PR title '$PR_TITLE' is valid."
          fi
